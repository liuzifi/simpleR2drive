##simpleR2drive
-*å˜é‡*
-*PASSWORD*:'ç™»å½•å¯†ç '
-*MY_DRIVE_BUCKET*:'ç»‘å®šR2'
# Linklet Worker: ä¸€ä¸ªåŸºäº Cloudflare çš„æç®€çŸ­é“¾æ¥æœåŠ¡

è¿™æ˜¯ä¸€ä¸ªéƒ¨ç½²åœ¨ Cloudflare Workers ä¸Šçš„è½»é‡çº§ã€æ— æœåŠ¡å™¨çš„çŸ­é“¾æ¥åº”ç”¨ã€‚å®ƒä½¿ç”¨ Cloudflare D1 ä½œä¸ºæ•°æ®åº“ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„ç®¡ç†åå°ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **æ— æœåŠ¡å™¨**: æ— éœ€ç®¡ç†è™šæ‹Ÿæœºæˆ–å®¹å™¨ï¼Œå®Œå…¨ç”± Cloudflare é©±åŠ¨ã€‚
- **å¿«é€Ÿå“åº”**: å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²ï¼Œä¸ºç”¨æˆ·æä¾›æé€Ÿçš„åˆ›å»ºå’Œé‡å®šå‘ä½“éªŒã€‚
- **æŒä¹…åŒ–å­˜å‚¨**: ä½¿ç”¨ Cloudflare D1 (SQLite) æ•°æ®åº“å­˜å‚¨æ‰€æœ‰é“¾æ¥ã€‚
- **ç®¡ç†å‘˜åå°**: æä¾›ä¸€ä¸ªä½äº `/admin` çš„å®‰å…¨åå°ï¼Œç”¨äºæŸ¥çœ‹ã€ä¿®æ”¹å’Œåˆ é™¤æ‰€æœ‰é“¾æ¥ã€‚
- **æç®€é…ç½®**: æ‰€æœ‰é…ç½®å‡é€šè¿‡ Cloudflare æ§åˆ¶å°çš„ç¯å¢ƒå˜é‡å®Œæˆï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

---

## ğŸš€ éƒ¨ç½²æµç¨‹ (Deployment Workflow)

æ•´ä¸ªéƒ¨ç½²æµç¨‹å®Œå…¨åœ¨ Cloudflare çš„ç½‘é¡µæ§åˆ¶å°ä¸­å®Œæˆï¼Œæ— éœ€ä»»ä½•æœ¬åœ°å¼€å‘å·¥å…·ã€‚

### ç¬¬ä¸€æ­¥ï¼šé…ç½® Cloudflare D1 æ•°æ®åº“

1.  **åˆ›å»ºæ•°æ®åº“**:
    - ç™»å½• Cloudflare æ§åˆ¶å°ï¼Œå¯¼èˆªè‡³ `Workers & Pages` -> `D1`ã€‚
    - ç‚¹å‡» **Create database**ï¼Œå¹¶ä¸ºå®ƒå‘½åï¼ˆä¾‹å¦‚ `linklet-db`ï¼‰ã€‚

2.  **åˆ›å»ºæ•°æ®è¡¨ (Schema)**:
    - è¿›å…¥åˆšåˆ›å»ºçš„ `linklet-db` æ•°æ®åº“ã€‚
    - åœ¨ **Console** æ ‡ç­¾é¡µä¸­ï¼Œç²˜è´´å¹¶è¿è¡Œä»¥ä¸‹ SQL å‘½ä»¤æ¥åˆ›å»º `links` è¡¨ï¼š

    ```sql
    CREATE TABLE links (
      slug TEXT PRIMARY KEY,
      url TEXT NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    ```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¹¶é…ç½® Worker

1.  **åˆ›å»º Worker**:
    - å¯¼èˆªè‡³ `Workers & Pages`ï¼Œç‚¹å‡» **Create application**ã€‚
    - é€‰æ‹© **Create Worker**ï¼Œä¸ºä½ çš„ Worker å‘½åï¼ˆä¾‹å¦‚ `my-link-worker`ï¼‰ï¼Œç„¶åç‚¹å‡» **Deploy**ã€‚

2.  **é…ç½®ç¯å¢ƒå˜é‡**:
    - è¿›å…¥ä½ åˆšåˆ›å»ºçš„ Workerï¼Œç‚¹å‡» `Settings` -> `Variables`ã€‚
    - **ç»‘å®š D1 æ•°æ®åº“**:
        - åœ¨ `D1 Database Bindings` éƒ¨åˆ†ï¼Œç‚¹å‡» **Add binding**ã€‚
        - **Variable name**: `DB`
        - **D1 database**: é€‰æ‹©ä½ åˆšåˆšåˆ›å»ºçš„ `linklet-db`ã€‚
    - **è®¾ç½®ç®¡ç†å‘˜å¯†ç **:
        - åœ¨ `Environment Variables` éƒ¨åˆ†ï¼Œç‚¹å‡» **Add variable**ã€‚
        - **Variable name**: `ADMIN_PASSWORD`
        - **Value**: `è¾“å…¥ä¸€ä¸ªä½ è‡ªå·±è®¾ç½®çš„å®‰å…¨å¯†ç `
        - *ï¼ˆæ¨èï¼‰ç‚¹å‡»æ—è¾¹çš„é”å½¢å›¾æ ‡åŠ å¯†æ­¤å˜é‡ã€‚*
    - **è®¾ç½® JWT å¯†é’¥**:
        - å†æ¬¡ç‚¹å‡» **Add variable**ã€‚
        - **Variable name**: `JWT_SECRET`
        - **Value**: `è¾“å…¥ä¸€ä¸ªé•¿è€Œéšæœºçš„å­—ç¬¦ä¸²ä½œä¸ºç­¾åå¯†é’¥`

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½² Worker ä»£ç 

1.  **ç²˜è´´ä»£ç **:
    - è¿›å…¥ Worker çš„ **Code** æ ‡ç­¾é¡µã€‚
    - åˆ é™¤ç¼–è¾‘å™¨ä¸­æ‰€æœ‰çš„é»˜è®¤ä»£ç ã€‚
    - å°†é¡¹ç›®æä¾›çš„ `worker.js` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ã€‚

2.  **ä¿å­˜å¹¶éƒ¨ç½²**:
    - ç‚¹å‡» **Save and Deploy** æŒ‰é’®ã€‚

ğŸ‰ æ­å–œä½ ï¼ä½ çš„çŸ­é“¾æ¥æœåŠ¡ç°åœ¨å·²ç»æˆåŠŸéƒ¨ç½²å¹¶å¯ä»¥è®¿é—®äº†ã€‚

---

## ğŸ› ï¸ å¦‚ä½•ä½¿ç”¨

- **å…¬å…±ä¸»é¡µ**: è®¿é—®ä½ çš„ Worker URL (ä¾‹å¦‚ `https://my-link-worker.your-subdomain.workers.dev` ) å³å¯çœ‹åˆ°åˆ›å»ºçŸ­é“¾æ¥çš„å…¬å…±é¡µé¢ã€‚
- **ç®¡ç†å‘˜åå°**: è®¿é—® `[ä½ çš„ Worker URL]/admin` (ä¾‹å¦‚ `https://my-link-worker.your-subdomain.workers.dev/admin` )ã€‚
- **ç™»å½•**: åœ¨åå°é¡µé¢è¾“å…¥ä½ åœ¨ç¯å¢ƒå˜é‡ `ADMIN_PASSWORD` ä¸­è®¾ç½®çš„å¯†ç è¿›è¡Œç™»å½•ã€‚
- **ç®¡ç†**: ç™»å½•åï¼Œä½ å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²åˆ›å»ºçš„çŸ­é“¾æ¥ï¼Œå¹¶è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤æ“ä½œã€‚

